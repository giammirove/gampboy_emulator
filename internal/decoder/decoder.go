package decoder

import (
	"encoding/binary"
	"encoding/json"
	"fmt"
	"log"

	mmu "github.com/giammirove/gampboy_emulator/internal/mmu"
)

const OPCODE_JSON_PATH = "./assets/newopcodes.json"
const OPCODE_PREFIX = 0xCB

// TODO: dont use this lol
var opcodes_json = `[[{"mnemonic":"NOP","opcode":0,"bytes":1,"operands":[]},{"mnemonic":"LD","opcode":1,"bytes":3,"operands":[{"name":"BC","immediate":true},{"name":"d16","bytes":2,"immediate":true}]},{"mnemonic":"LD","opcode":2,"bytes":1,"operands":[{"name":"BC","immediate":false},{"name":"A","immediate":true}]},{"mnemonic":"INC","opcode":3,"bytes":1,"operands":[{"name":"BC","immediate":true}]},{"mnemonic":"INC","opcode":4,"bytes":1,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"DEC","opcode":5,"bytes":1,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"LD","opcode":6,"bytes":2,"operands":[{"name":"B","immediate":true},{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"RLCA","opcode":7,"bytes":1,"operands":[]},{"mnemonic":"LD","opcode":8,"bytes":3,"operands":[{"name":"a16","bytes":2,"immediate":false},{"name":"SP","immediate":true}]},{"mnemonic":"ADD","opcode":9,"bytes":1,"operands":[{"name":"HL","immediate":true},{"name":"BC","immediate":true}]},{"mnemonic":"LD","opcode":10,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"BC","immediate":false}]},{"mnemonic":"DEC","opcode":11,"bytes":1,"operands":[{"name":"BC","immediate":true}]},{"mnemonic":"INC","opcode":12,"bytes":1,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"DEC","opcode":13,"bytes":1,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"LD","opcode":14,"bytes":2,"operands":[{"name":"C","immediate":true},{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"RRCA","opcode":15,"bytes":1,"operands":[]},{"mnemonic":"STOP","opcode":16,"bytes":2,"operands":[{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"LD","opcode":17,"bytes":3,"operands":[{"name":"DE","immediate":true},{"name":"d16","bytes":2,"immediate":true}]},{"mnemonic":"LD","opcode":18,"bytes":1,"operands":[{"name":"DE","immediate":false},{"name":"A","immediate":true}]},{"mnemonic":"INC","opcode":19,"bytes":1,"operands":[{"name":"DE","immediate":true}]},{"mnemonic":"INC","opcode":20,"bytes":1,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"DEC","opcode":21,"bytes":1,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"LD","opcode":22,"bytes":2,"operands":[{"name":"D","immediate":true},{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"RLA","opcode":23,"bytes":1,"operands":[]},{"mnemonic":"JR","opcode":24,"bytes":2,"operands":[{"name":"r8","bytes":1,"immediate":true}]},{"mnemonic":"ADD","opcode":25,"bytes":1,"operands":[{"name":"HL","immediate":true},{"name":"DE","immediate":true}]},{"mnemonic":"LD","opcode":26,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"DE","immediate":false}]},{"mnemonic":"DEC","opcode":27,"bytes":1,"operands":[{"name":"DE","immediate":true}]},{"mnemonic":"INC","opcode":28,"bytes":1,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"DEC","opcode":29,"bytes":1,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"LD","opcode":30,"bytes":2,"operands":[{"name":"E","immediate":true},{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"RRA","opcode":31,"bytes":1,"operands":[]},{"mnemonic":"JR","opcode":32,"bytes":2,"operands":[{"name":"NZ","immediate":true},{"name":"r8","bytes":1,"immediate":true}]},{"mnemonic":"LD","opcode":33,"bytes":3,"operands":[{"name":"HL","immediate":true},{"name":"d16","bytes":2,"immediate":true}]},{"mnemonic":"LD","opcode":34,"bytes":1,"operands":[{"name":"HL","increment":true,"immediate":false},{"name":"A","immediate":true}]},{"mnemonic":"INC","opcode":35,"bytes":1,"operands":[{"name":"HL","immediate":true}]},{"mnemonic":"INC","opcode":36,"bytes":1,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"DEC","opcode":37,"bytes":1,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"LD","opcode":38,"bytes":2,"operands":[{"name":"H","immediate":true},{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"DAA","opcode":39,"bytes":1,"operands":[]},{"mnemonic":"JR","opcode":40,"bytes":2,"operands":[{"name":"Z","immediate":true},{"name":"r8","bytes":1,"immediate":true}]},{"mnemonic":"ADD","opcode":41,"bytes":1,"operands":[{"name":"HL","immediate":true},{"name":"HL","immediate":true}]},{"mnemonic":"LD","opcode":42,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"HL","increment":true,"immediate":false}]},{"mnemonic":"DEC","opcode":43,"bytes":1,"operands":[{"name":"HL","immediate":true}]},{"mnemonic":"INC","opcode":44,"bytes":1,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"DEC","opcode":45,"bytes":1,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"LD","opcode":46,"bytes":2,"operands":[{"name":"L","immediate":true},{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"CPL","opcode":47,"bytes":1,"operands":[]},{"mnemonic":"JR","opcode":48,"bytes":2,"operands":[{"name":"NC","immediate":true},{"name":"r8","bytes":1,"immediate":true}]},{"mnemonic":"LD","opcode":49,"bytes":3,"operands":[{"name":"SP","immediate":true},{"name":"d16","bytes":2,"immediate":true}]},{"mnemonic":"LD","opcode":50,"bytes":1,"operands":[{"name":"HL","decrement":true,"immediate":false},{"name":"A","immediate":true}]},{"mnemonic":"INC","opcode":51,"bytes":1,"operands":[{"name":"SP","immediate":true}]},{"mnemonic":"INC","opcode":52,"bytes":1,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"DEC","opcode":53,"bytes":1,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"LD","opcode":54,"bytes":2,"operands":[{"name":"HL","immediate":false},{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"SCF","opcode":55,"bytes":1,"operands":[]},{"mnemonic":"JR","opcode":56,"bytes":2,"operands":[{"name":"C","immediate":true},{"name":"r8","bytes":1,"immediate":true}]},{"mnemonic":"ADD","opcode":57,"bytes":1,"operands":[{"name":"HL","immediate":true},{"name":"SP","immediate":true}]},{"mnemonic":"LD","opcode":58,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"HL","decrement":true,"immediate":false}]},{"mnemonic":"DEC","opcode":59,"bytes":1,"operands":[{"name":"SP","immediate":true}]},{"mnemonic":"INC","opcode":60,"bytes":1,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"DEC","opcode":61,"bytes":1,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"LD","opcode":62,"bytes":2,"operands":[{"name":"A","immediate":true},{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"CCF","opcode":63,"bytes":1,"operands":[]},{"mnemonic":"LD","opcode":64,"bytes":1,"operands":[{"name":"B","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"LD","opcode":65,"bytes":1,"operands":[{"name":"B","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"LD","opcode":66,"bytes":1,"operands":[{"name":"B","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"LD","opcode":67,"bytes":1,"operands":[{"name":"B","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"LD","opcode":68,"bytes":1,"operands":[{"name":"B","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"LD","opcode":69,"bytes":1,"operands":[{"name":"B","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"LD","opcode":70,"bytes":1,"operands":[{"name":"B","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"LD","opcode":71,"bytes":1,"operands":[{"name":"B","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"LD","opcode":72,"bytes":1,"operands":[{"name":"C","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"LD","opcode":73,"bytes":1,"operands":[{"name":"C","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"LD","opcode":74,"bytes":1,"operands":[{"name":"C","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"LD","opcode":75,"bytes":1,"operands":[{"name":"C","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"LD","opcode":76,"bytes":1,"operands":[{"name":"C","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"LD","opcode":77,"bytes":1,"operands":[{"name":"C","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"LD","opcode":78,"bytes":1,"operands":[{"name":"C","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"LD","opcode":79,"bytes":1,"operands":[{"name":"C","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"LD","opcode":80,"bytes":1,"operands":[{"name":"D","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"LD","opcode":81,"bytes":1,"operands":[{"name":"D","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"LD","opcode":82,"bytes":1,"operands":[{"name":"D","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"LD","opcode":83,"bytes":1,"operands":[{"name":"D","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"LD","opcode":84,"bytes":1,"operands":[{"name":"D","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"LD","opcode":85,"bytes":1,"operands":[{"name":"D","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"LD","opcode":86,"bytes":1,"operands":[{"name":"D","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"LD","opcode":87,"bytes":1,"operands":[{"name":"D","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"LD","opcode":88,"bytes":1,"operands":[{"name":"E","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"LD","opcode":89,"bytes":1,"operands":[{"name":"E","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"LD","opcode":90,"bytes":1,"operands":[{"name":"E","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"LD","opcode":91,"bytes":1,"operands":[{"name":"E","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"LD","opcode":92,"bytes":1,"operands":[{"name":"E","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"LD","opcode":93,"bytes":1,"operands":[{"name":"E","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"LD","opcode":94,"bytes":1,"operands":[{"name":"E","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"LD","opcode":95,"bytes":1,"operands":[{"name":"E","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"LD","opcode":96,"bytes":1,"operands":[{"name":"H","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"LD","opcode":97,"bytes":1,"operands":[{"name":"H","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"LD","opcode":98,"bytes":1,"operands":[{"name":"H","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"LD","opcode":99,"bytes":1,"operands":[{"name":"H","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"LD","opcode":100,"bytes":1,"operands":[{"name":"H","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"LD","opcode":101,"bytes":1,"operands":[{"name":"H","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"LD","opcode":102,"bytes":1,"operands":[{"name":"H","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"LD","opcode":103,"bytes":1,"operands":[{"name":"H","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"LD","opcode":104,"bytes":1,"operands":[{"name":"L","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"LD","opcode":105,"bytes":1,"operands":[{"name":"L","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"LD","opcode":106,"bytes":1,"operands":[{"name":"L","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"LD","opcode":107,"bytes":1,"operands":[{"name":"L","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"LD","opcode":108,"bytes":1,"operands":[{"name":"L","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"LD","opcode":109,"bytes":1,"operands":[{"name":"L","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"LD","opcode":110,"bytes":1,"operands":[{"name":"L","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"LD","opcode":111,"bytes":1,"operands":[{"name":"L","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"LD","opcode":112,"bytes":1,"operands":[{"name":"HL","immediate":false},{"name":"B","immediate":true}]},{"mnemonic":"LD","opcode":113,"bytes":1,"operands":[{"name":"HL","immediate":false},{"name":"C","immediate":true}]},{"mnemonic":"LD","opcode":114,"bytes":1,"operands":[{"name":"HL","immediate":false},{"name":"D","immediate":true}]},{"mnemonic":"LD","opcode":115,"bytes":1,"operands":[{"name":"HL","immediate":false},{"name":"E","immediate":true}]},{"mnemonic":"LD","opcode":116,"bytes":1,"operands":[{"name":"HL","immediate":false},{"name":"H","immediate":true}]},{"mnemonic":"LD","opcode":117,"bytes":1,"operands":[{"name":"HL","immediate":false},{"name":"L","immediate":true}]},{"mnemonic":"HALT","opcode":118,"bytes":1,"operands":[]},{"mnemonic":"LD","opcode":119,"bytes":1,"operands":[{"name":"HL","immediate":false},{"name":"A","immediate":true}]},{"mnemonic":"LD","opcode":120,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"LD","opcode":121,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"LD","opcode":122,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"LD","opcode":123,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"LD","opcode":124,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"LD","opcode":125,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"LD","opcode":126,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"LD","opcode":127,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"ADD","opcode":128,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"ADD","opcode":129,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"ADD","opcode":130,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"ADD","opcode":131,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"ADD","opcode":132,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"ADD","opcode":133,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"ADD","opcode":134,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"ADD","opcode":135,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"ADC","opcode":136,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"ADC","opcode":137,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"ADC","opcode":138,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"ADC","opcode":139,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"ADC","opcode":140,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"ADC","opcode":141,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"ADC","opcode":142,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"ADC","opcode":143,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"SUB","opcode":144,"bytes":1,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"SUB","opcode":145,"bytes":1,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"SUB","opcode":146,"bytes":1,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"SUB","opcode":147,"bytes":1,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"SUB","opcode":148,"bytes":1,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"SUB","opcode":149,"bytes":1,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"SUB","opcode":150,"bytes":1,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"SUB","opcode":151,"bytes":1,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"SBC","opcode":152,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"SBC","opcode":153,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"SBC","opcode":154,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"SBC","opcode":155,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"SBC","opcode":156,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"SBC","opcode":157,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"SBC","opcode":158,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"SBC","opcode":159,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"AND","opcode":160,"bytes":1,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"AND","opcode":161,"bytes":1,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"AND","opcode":162,"bytes":1,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"AND","opcode":163,"bytes":1,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"AND","opcode":164,"bytes":1,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"AND","opcode":165,"bytes":1,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"AND","opcode":166,"bytes":1,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"AND","opcode":167,"bytes":1,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"XOR","opcode":168,"bytes":1,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"XOR","opcode":169,"bytes":1,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"XOR","opcode":170,"bytes":1,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"XOR","opcode":171,"bytes":1,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"XOR","opcode":172,"bytes":1,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"XOR","opcode":173,"bytes":1,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"XOR","opcode":174,"bytes":1,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"XOR","opcode":175,"bytes":1,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"OR","opcode":176,"bytes":1,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"OR","opcode":177,"bytes":1,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"OR","opcode":178,"bytes":1,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"OR","opcode":179,"bytes":1,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"OR","opcode":180,"bytes":1,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"OR","opcode":181,"bytes":1,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"OR","opcode":182,"bytes":1,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"OR","opcode":183,"bytes":1,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"CP","opcode":184,"bytes":1,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"CP","opcode":185,"bytes":1,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"CP","opcode":186,"bytes":1,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"CP","opcode":187,"bytes":1,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"CP","opcode":188,"bytes":1,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"CP","opcode":189,"bytes":1,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"CP","opcode":190,"bytes":1,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"CP","opcode":191,"bytes":1,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"RET","opcode":192,"bytes":1,"operands":[{"name":"NZ","immediate":true}]},{"mnemonic":"POP","opcode":193,"bytes":1,"operands":[{"name":"BC","immediate":true}]},{"mnemonic":"JP","opcode":194,"bytes":3,"operands":[{"name":"NZ","immediate":true},{"name":"a16","bytes":2,"immediate":true}]},{"mnemonic":"JP","opcode":195,"bytes":3,"operands":[{"name":"a16","bytes":2,"immediate":true}]},{"mnemonic":"CALL","opcode":196,"bytes":3,"operands":[{"name":"NZ","immediate":true},{"name":"a16","bytes":2,"immediate":true}]},{"mnemonic":"PUSH","opcode":197,"bytes":1,"operands":[{"name":"BC","immediate":true}]},{"mnemonic":"ADD","opcode":198,"bytes":2,"operands":[{"name":"A","immediate":true},{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"RST","opcode":199,"bytes":1,"operands":[{"name":"00H","immediate":true}]},{"mnemonic":"RET","opcode":200,"bytes":1,"operands":[{"name":"Z","immediate":true}]},{"mnemonic":"RET","opcode":201,"bytes":1,"operands":[]},{"mnemonic":"JP","opcode":202,"bytes":3,"operands":[{"name":"Z","immediate":true},{"name":"a16","bytes":2,"immediate":true}]},{"mnemonic":"PREFIX","opcode":203,"bytes":1,"operands":[]},{"mnemonic":"CALL","opcode":204,"bytes":3,"operands":[{"name":"Z","immediate":true},{"name":"a16","bytes":2,"immediate":true}]},{"mnemonic":"CALL","opcode":205,"bytes":3,"operands":[{"name":"a16","bytes":2,"immediate":true}]},{"mnemonic":"ADC","opcode":206,"bytes":2,"operands":[{"name":"A","immediate":true},{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"RST","opcode":207,"bytes":1,"operands":[{"name":"08H","immediate":true}]},{"mnemonic":"RET","opcode":208,"bytes":1,"operands":[{"name":"NC","immediate":true}]},{"mnemonic":"POP","opcode":209,"bytes":1,"operands":[{"name":"DE","immediate":true}]},{"mnemonic":"JP","opcode":210,"bytes":3,"operands":[{"name":"NC","immediate":true},{"name":"a16","bytes":2,"immediate":true}]},{"mnemonic":"ILLEGAL_D3","opcode":211,"bytes":1,"operands":[]},{"mnemonic":"CALL","opcode":212,"bytes":3,"operands":[{"name":"NC","immediate":true},{"name":"a16","bytes":2,"immediate":true}]},{"mnemonic":"PUSH","opcode":213,"bytes":1,"operands":[{"name":"DE","immediate":true}]},{"mnemonic":"SUB","opcode":214,"bytes":2,"operands":[{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"RST","opcode":215,"bytes":1,"operands":[{"name":"10H","immediate":true}]},{"mnemonic":"RET","opcode":216,"bytes":1,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"RETI","opcode":217,"bytes":1,"operands":[]},{"mnemonic":"JP","opcode":218,"bytes":3,"operands":[{"name":"C","immediate":true},{"name":"a16","bytes":2,"immediate":true}]},{"mnemonic":"ILLEGAL_DB","opcode":219,"bytes":1,"operands":[]},{"mnemonic":"CALL","opcode":220,"bytes":3,"operands":[{"name":"C","immediate":true},{"name":"a16","bytes":2,"immediate":true}]},{"mnemonic":"ILLEGAL_DD","opcode":221,"bytes":1,"operands":[]},{"mnemonic":"SBC","opcode":222,"bytes":2,"operands":[{"name":"A","immediate":true},{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"RST","opcode":223,"bytes":1,"operands":[{"name":"18H","immediate":true}]},{"mnemonic":"LDH","opcode":224,"bytes":2,"operands":[{"name":"a8","bytes":1,"immediate":false},{"name":"A","immediate":true}]},{"mnemonic":"POP","opcode":225,"bytes":1,"operands":[{"name":"HL","immediate":true}]},{"mnemonic":"LD","opcode":226,"bytes":1,"operands":[{"name":"C","immediate":false},{"name":"A","immediate":true}]},{"mnemonic":"ILLEGAL_E3","opcode":227,"bytes":1,"operands":[]},{"mnemonic":"ILLEGAL_E4","opcode":228,"bytes":1,"operands":[]},{"mnemonic":"PUSH","opcode":229,"bytes":1,"operands":[{"name":"HL","immediate":true}]},{"mnemonic":"AND","opcode":230,"bytes":2,"operands":[{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"RST","opcode":231,"bytes":1,"operands":[{"name":"20H","immediate":true}]},{"mnemonic":"ADD","opcode":232,"bytes":2,"operands":[{"name":"SP","immediate":true},{"name":"r8","bytes":1,"immediate":true}]},{"mnemonic":"JP","opcode":233,"bytes":1,"operands":[{"name":"HL","immediate":true}]},{"mnemonic":"LD","opcode":234,"bytes":3,"operands":[{"name":"a16","bytes":2,"immediate":false},{"name":"A","immediate":true}]},{"mnemonic":"ILLEGAL_EB","opcode":235,"bytes":1,"operands":[]},{"mnemonic":"ILLEGAL_EC","opcode":236,"bytes":1,"operands":[]},{"mnemonic":"ILLEGAL_ED","opcode":237,"bytes":1,"operands":[]},{"mnemonic":"XOR","opcode":238,"bytes":2,"operands":[{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"RST","opcode":239,"bytes":1,"operands":[{"name":"28H","immediate":true}]},{"mnemonic":"LDH","opcode":240,"bytes":2,"operands":[{"name":"A","immediate":true},{"name":"a8","bytes":1,"immediate":false}]},{"mnemonic":"POP","opcode":241,"bytes":1,"operands":[{"name":"AF","immediate":true}]},{"mnemonic":"LD","opcode":242,"bytes":1,"operands":[{"name":"A","immediate":true},{"name":"C","immediate":false}]},{"mnemonic":"DI","opcode":243,"bytes":1,"operands":[]},{"mnemonic":"ILLEGAL_F4","opcode":244,"bytes":1,"operands":[]},{"mnemonic":"PUSH","opcode":245,"bytes":1,"operands":[{"name":"AF","immediate":true}]},{"mnemonic":"OR","opcode":246,"bytes":2,"operands":[{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"RST","opcode":247,"bytes":1,"operands":[{"name":"30H","immediate":true}]},{"mnemonic":"LD","opcode":248,"bytes":2,"operands":[{"name":"HL","immediate":true},{"name":"SP","increment":true,"immediate":true},{"name":"r8","bytes":1,"immediate":true}]},{"mnemonic":"LD","opcode":249,"bytes":1,"operands":[{"name":"SP","immediate":true},{"name":"HL","immediate":true}]},{"mnemonic":"LD","opcode":250,"bytes":3,"operands":[{"name":"A","immediate":true},{"name":"a16","bytes":2,"immediate":false}]},{"mnemonic":"EI","opcode":251,"bytes":1,"operands":[]},{"mnemonic":"ILLEGAL_FC","opcode":252,"bytes":1,"operands":[]},{"mnemonic":"ILLEGAL_FD","opcode":253,"bytes":1,"operands":[]},{"mnemonic":"CP","opcode":254,"bytes":2,"operands":[{"name":"d8","bytes":1,"immediate":true}]},{"mnemonic":"RST","opcode":255,"bytes":1,"operands":[{"name":"38H","immediate":true}]}],[{"mnemonic":"RLC","opcode":0,"bytes":2,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"RLC","opcode":1,"bytes":2,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"RLC","opcode":2,"bytes":2,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"RLC","opcode":3,"bytes":2,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"RLC","opcode":4,"bytes":2,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"RLC","opcode":5,"bytes":2,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"RLC","opcode":6,"bytes":2,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"RLC","opcode":7,"bytes":2,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"RRC","opcode":8,"bytes":2,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"RRC","opcode":9,"bytes":2,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"RRC","opcode":10,"bytes":2,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"RRC","opcode":11,"bytes":2,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"RRC","opcode":12,"bytes":2,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"RRC","opcode":13,"bytes":2,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"RRC","opcode":14,"bytes":2,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"RRC","opcode":15,"bytes":2,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"RL","opcode":16,"bytes":2,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"RL","opcode":17,"bytes":2,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"RL","opcode":18,"bytes":2,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"RL","opcode":19,"bytes":2,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"RL","opcode":20,"bytes":2,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"RL","opcode":21,"bytes":2,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"RL","opcode":22,"bytes":2,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"RL","opcode":23,"bytes":2,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"RR","opcode":24,"bytes":2,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"RR","opcode":25,"bytes":2,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"RR","opcode":26,"bytes":2,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"RR","opcode":27,"bytes":2,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"RR","opcode":28,"bytes":2,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"RR","opcode":29,"bytes":2,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"RR","opcode":30,"bytes":2,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"RR","opcode":31,"bytes":2,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"SLA","opcode":32,"bytes":2,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"SLA","opcode":33,"bytes":2,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"SLA","opcode":34,"bytes":2,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"SLA","opcode":35,"bytes":2,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"SLA","opcode":36,"bytes":2,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"SLA","opcode":37,"bytes":2,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"SLA","opcode":38,"bytes":2,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"SLA","opcode":39,"bytes":2,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"SRA","opcode":40,"bytes":2,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"SRA","opcode":41,"bytes":2,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"SRA","opcode":42,"bytes":2,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"SRA","opcode":43,"bytes":2,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"SRA","opcode":44,"bytes":2,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"SRA","opcode":45,"bytes":2,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"SRA","opcode":46,"bytes":2,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"SRA","opcode":47,"bytes":2,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"SWAP","opcode":48,"bytes":2,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"SWAP","opcode":49,"bytes":2,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"SWAP","opcode":50,"bytes":2,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"SWAP","opcode":51,"bytes":2,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"SWAP","opcode":52,"bytes":2,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"SWAP","opcode":53,"bytes":2,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"SWAP","opcode":54,"bytes":2,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"SWAP","opcode":55,"bytes":2,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"SRL","opcode":56,"bytes":2,"operands":[{"name":"B","immediate":true}]},{"mnemonic":"SRL","opcode":57,"bytes":2,"operands":[{"name":"C","immediate":true}]},{"mnemonic":"SRL","opcode":58,"bytes":2,"operands":[{"name":"D","immediate":true}]},{"mnemonic":"SRL","opcode":59,"bytes":2,"operands":[{"name":"E","immediate":true}]},{"mnemonic":"SRL","opcode":60,"bytes":2,"operands":[{"name":"H","immediate":true}]},{"mnemonic":"SRL","opcode":61,"bytes":2,"operands":[{"name":"L","immediate":true}]},{"mnemonic":"SRL","opcode":62,"bytes":2,"operands":[{"name":"HL","immediate":false}]},{"mnemonic":"SRL","opcode":63,"bytes":2,"operands":[{"name":"A","immediate":true}]},{"mnemonic":"BIT","opcode":64,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"BIT","opcode":65,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"BIT","opcode":66,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"BIT","opcode":67,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"BIT","opcode":68,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"BIT","opcode":69,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"BIT","opcode":70,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"BIT","opcode":71,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"BIT","opcode":72,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"BIT","opcode":73,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"BIT","opcode":74,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"BIT","opcode":75,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"BIT","opcode":76,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"BIT","opcode":77,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"BIT","opcode":78,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"BIT","opcode":79,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"BIT","opcode":80,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"BIT","opcode":81,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"BIT","opcode":82,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"BIT","opcode":83,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"BIT","opcode":84,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"BIT","opcode":85,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"BIT","opcode":86,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"BIT","opcode":87,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"BIT","opcode":88,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"BIT","opcode":89,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"BIT","opcode":90,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"BIT","opcode":91,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"BIT","opcode":92,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"BIT","opcode":93,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"BIT","opcode":94,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"BIT","opcode":95,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"BIT","opcode":96,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"BIT","opcode":97,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"BIT","opcode":98,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"BIT","opcode":99,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"BIT","opcode":100,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"BIT","opcode":101,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"BIT","opcode":102,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"BIT","opcode":103,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"BIT","opcode":104,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"BIT","opcode":105,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"BIT","opcode":106,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"BIT","opcode":107,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"BIT","opcode":108,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"BIT","opcode":109,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"BIT","opcode":110,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"BIT","opcode":111,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"BIT","opcode":112,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"BIT","opcode":113,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"BIT","opcode":114,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"BIT","opcode":115,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"BIT","opcode":116,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"BIT","opcode":117,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"BIT","opcode":118,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"BIT","opcode":119,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"BIT","opcode":120,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"BIT","opcode":121,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"BIT","opcode":122,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"BIT","opcode":123,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"BIT","opcode":124,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"BIT","opcode":125,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"BIT","opcode":126,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"BIT","opcode":127,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"RES","opcode":128,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"RES","opcode":129,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"RES","opcode":130,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"RES","opcode":131,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"RES","opcode":132,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"RES","opcode":133,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"RES","opcode":134,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"RES","opcode":135,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"RES","opcode":136,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"RES","opcode":137,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"RES","opcode":138,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"RES","opcode":139,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"RES","opcode":140,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"RES","opcode":141,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"RES","opcode":142,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"RES","opcode":143,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"RES","opcode":144,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"RES","opcode":145,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"RES","opcode":146,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"RES","opcode":147,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"RES","opcode":148,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"RES","opcode":149,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"RES","opcode":150,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"RES","opcode":151,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"RES","opcode":152,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"RES","opcode":153,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"RES","opcode":154,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"RES","opcode":155,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"RES","opcode":156,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"RES","opcode":157,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"RES","opcode":158,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"RES","opcode":159,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"RES","opcode":160,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"RES","opcode":161,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"RES","opcode":162,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"RES","opcode":163,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"RES","opcode":164,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"RES","opcode":165,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"RES","opcode":166,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"RES","opcode":167,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"RES","opcode":168,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"RES","opcode":169,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"RES","opcode":170,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"RES","opcode":171,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"RES","opcode":172,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"RES","opcode":173,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"RES","opcode":174,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"RES","opcode":175,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"RES","opcode":176,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"RES","opcode":177,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"RES","opcode":178,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"RES","opcode":179,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"RES","opcode":180,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"RES","opcode":181,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"RES","opcode":182,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"RES","opcode":183,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"RES","opcode":184,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"RES","opcode":185,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"RES","opcode":186,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"RES","opcode":187,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"RES","opcode":188,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"RES","opcode":189,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"RES","opcode":190,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"RES","opcode":191,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"SET","opcode":192,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"SET","opcode":193,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"SET","opcode":194,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"SET","opcode":195,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"SET","opcode":196,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"SET","opcode":197,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"SET","opcode":198,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"SET","opcode":199,"bytes":2,"operands":[{"name":"0","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"SET","opcode":200,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"SET","opcode":201,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"SET","opcode":202,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"SET","opcode":203,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"SET","opcode":204,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"SET","opcode":205,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"SET","opcode":206,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"SET","opcode":207,"bytes":2,"operands":[{"name":"1","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"SET","opcode":208,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"SET","opcode":209,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"SET","opcode":210,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"SET","opcode":211,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"SET","opcode":212,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"SET","opcode":213,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"SET","opcode":214,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"SET","opcode":215,"bytes":2,"operands":[{"name":"2","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"SET","opcode":216,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"SET","opcode":217,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"SET","opcode":218,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"SET","opcode":219,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"SET","opcode":220,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"SET","opcode":221,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"SET","opcode":222,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"SET","opcode":223,"bytes":2,"operands":[{"name":"3","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"SET","opcode":224,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"SET","opcode":225,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"SET","opcode":226,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"SET","opcode":227,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"SET","opcode":228,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"SET","opcode":229,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"SET","opcode":230,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"SET","opcode":231,"bytes":2,"operands":[{"name":"4","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"SET","opcode":232,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"SET","opcode":233,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"SET","opcode":234,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"SET","opcode":235,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"SET","opcode":236,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"SET","opcode":237,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"SET","opcode":238,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"SET","opcode":239,"bytes":2,"operands":[{"name":"5","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"SET","opcode":240,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"SET","opcode":241,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"SET","opcode":242,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"SET","opcode":243,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"SET","opcode":244,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"SET","opcode":245,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"SET","opcode":246,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"SET","opcode":247,"bytes":2,"operands":[{"name":"6","immediate":true},{"name":"A","immediate":true}]},{"mnemonic":"SET","opcode":248,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"B","immediate":true}]},{"mnemonic":"SET","opcode":249,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"C","immediate":true}]},{"mnemonic":"SET","opcode":250,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"D","immediate":true}]},{"mnemonic":"SET","opcode":251,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"E","immediate":true}]},{"mnemonic":"SET","opcode":252,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"H","immediate":true}]},{"mnemonic":"SET","opcode":253,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"L","immediate":true}]},{"mnemonic":"SET","opcode":254,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"HL","immediate":false}]},{"mnemonic":"SET","opcode":255,"bytes":2,"operands":[{"name":"7","immediate":true},{"name":"A","immediate":true}]}]]`

// d8 in opcodes.json is the input -> d8 == n,#
// -> one byte signed immediate value
// a16,d16 -> nn -> two byte immediate value.

type Operand_t struct {
	Name      string
	Immediate bool
	Decrement bool
	Increment bool
	Bytes     uint
	Withvalue bool
	Value     uint
}

type Instruction_t struct {
	Opcode   uint
	Operands []Operand_t
	Bytes    uint
	Mnemonic string
}

var instructions [2][]Instruction_t
var data []byte
var Cycle func(val uint)

func InitDecoder() {
	ReadOpcodes()
}

func ReadOpcodes() {
	err := json.Unmarshal([]byte(opcodes_json), &instructions)
	if err != nil {
		log.Fatal(err)
	}

}

func read_from_data(addr uint, args ...uint) uint {

	if len(args) > 1 {
		log.Fatal("Too many parameters")
	}

	length := uint(1)
	if len(args) == 1 {
		length = args[0]
	}

	end := int(addr + length)
	if end < 0 || end >= len(data) {
		log.Fatal("Out of bound")
	}

	var arr []byte
	for i := 0; i < int(length); i++ {
		arr = append(arr, data[int(addr)+i])
	}
	for i := length; i < 4; i++ {
		arr = append(arr, 0x00)
	}
	return uint(binary.LittleEndian.Uint32(arr))
}

func copyInstruction(dst *Instruction_t, src Instruction_t) {
	dst.Bytes = src.Bytes
	dst.Mnemonic = src.Mnemonic
	dst.Opcode = src.Opcode
	dst.Operands = append(dst.Operands, src.Operands...)
}

func printOperand(operand Operand_t) string {
	s := ""
	if operand.Withvalue {
		if operand.Bytes > 0 {
			s += fmt.Sprintf("0x%X", operand.Value)
		} else {
			s += fmt.Sprintf("%s", operand.Name)
		}
	} else {
		s += operand.Name
	}
	if operand.Decrement {
		s += "-"
	}
	if operand.Increment {
		s += "+"
	}
	if operand.Immediate {
		return s
	}
	return fmt.Sprintf("(%s)", s)
}

func PrintInstrunction(ins Instruction_t) string {
	s := fmt.Sprintf("(%02X) %s ", ins.Opcode, ins.Mnemonic)
	for i := 0; i < len(ins.Operands); i++ {
		s += fmt.Sprintf("%s", printOperand(ins.Operands[i]))
		if i < len(ins.Operands)-1 {
			s += ","
		}
	}
	return s
}

func Decode(addr *uint) Instruction_t {

	Cycle(4)
	opcode := mmu.ReadFromMemoryCPU(*addr)
	(*addr)++

	instruction := Instruction_t{}
	index := 0
	if opcode == OPCODE_PREFIX {
		Cycle(4)
		opcode = mmu.ReadFromMemoryCPU(*addr)
		(*addr)++
		index = 1
	}
	copyInstruction(&instruction, instructions[index][opcode])

	if instruction.Mnemonic == "" {
		log.Fatal("Opcodes not found")
	}

	instruction.Opcode = uint(opcode)

	operands := instruction.Operands
	for i := 0; i < len(operands); i++ {
		op := operands[i]
		if op.Bytes > 0 {
			Cycle(4 * uint(op.Bytes))
			value := mmu.ReadFromMemoryCPU(*addr, op.Bytes)
			(*addr) += op.Bytes
			op.Value = value
			op.Withvalue = true
		} else {
			op.Bytes = 1
		}
		operands[i] = op
	}

	return instruction
}
